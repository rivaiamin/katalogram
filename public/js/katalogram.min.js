
var catalogEditCtrl=["$stateParams","$scope","$rootScope","$http","$sce","kgConfig",function(t,e,c,o,a,d){e.modal1=UIkit.modal("#cropmeModal"),e.modal2=UIkit.modal("#cropmeModal2"),e.addPreview=!1,e.preview={},o({method:"GET",url:d.api+"catalog/"+t.productId+"/edit"}).success(function(t){e.edit=t,e.edit.product=t.product[0],e.productId=e.edit.product.id,e.catInd=e.categories.map(function(t){return t.id}).indexOf(e.edit.product.category_id),e.categories=c.categories,$(".ui.checkbox").checkbox(),$(".ui.accordion").accordion("refresh"),$(".special.cards .image").dimmer({on:"hover"})}),e.selectCats=function(){e.catInd=$("#categoryId").prop("selectedIndex")-1},e.saveLogo=function(t,c){o.put(d.api+"catalog/"+e.productId+"/logo",{product_logo:t}).success(function(c){UIkit.notify(c.message,c.status),e.edit.product.product_logo=t})},e.savePreview=function(t){o.post(d.api+"catalog/"+e.productId+"/preview",t).success(function(t){UIkit.notify(t.message,t.status),e.addPreview=!1})},e.addCriteria=function(t){o.post(d.api+"catalog/"+e.productId+"/criteria",t).success(function(t){return"success"==t.status?!0:!1})},e.removeCriteria=function(t){return confirm("hapus kriteria?")?void o["delete"](d.api+"catalog/"+e.productId+"/criteria/"+t.id).success(function(t){return"success"==t.status?!0:void 0}):!1},e.addTag=function(t){o.post(d.api+"catalog/"+e.productId+"/tag",t).success(function(t){return"success"==t.status?!0:!1})},e.removeTag=function(t){return confirm("hapus tag?")?void o["delete"](d.api+"catalog/"+e.productId+"/tag/"+t.id).success(function(t){return"success"==t.status?!0:void 0}):!1},e.updateCatalog=function(t,c){var a={product_name:t.product_name,category_id:t.category_id,product_quote:t.product_quote,product_data:t.product_data,product_desc:t.product_desc,product_embed:t.product_embed};if(1==c){if(!confirm("simpan dan publikasikan?"))return!1;a.product_release=1}o.put(d.api+"catalog/"+e.productId,a).success(function(t){UIkit.notify(t.message,t.status)})},e.$on("cropme:done",function(t,c,a){var i=c.croppedImage;"cropme1"==a[0].id?o({method:"POST",url:d.files+"saveimage.php",data:i,headers:{"Content-Type":i.type}}).success(function(t){"success"==t.status&&(e.saveLogo(t.filename,i),e.modal1.hide())}):"cropme2"==a[0].id&&o({method:"POST",url:d.files+"savepreview.php",data:i,headers:{"Content-Type":i.type}}).success(function(t){"success"==t.status&&(e.addPreview=!0,e.preview.preview_pict=t.filename,e.modal2.hide())})})}];
var catalogCtrl=["$scope","$http","$location","$stateParams","kgConfig",function(a,t,l,s,o){a.catalogs=[],a.scrollBusy=!1,a.limit=12,a.after=0,a.onSearch=!1,a.filter={},a.url=l.absUrl(),a.catalogList=function(){a.scrollBusy=!0,t.get(o.api+"catalog/"+a.after+"/"+a.limit,{params:a.filter}).success(function(t){for(var l=0;l<t.catalogs.length;l++)a.catalogs.push(t.catalogs[l]);t.catalogs.length>0&&(a.after=t.catalogs[t.catalogs.length-1].id,a.scrollBusy=!1)})}}];
var config=["$stateProvider","$httpProvider","$urlRouterProvider","$authProvider","$locationProvider","kgConfig",function(t,l,a,e,o,r){t.state("home",{url:"/",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalog",{url:"/catalog",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalogCategory",{url:"/catalog/category/:categoryId",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalogDetail",{url:"/catalog/:productId",templateUrl:"catalog.detail.html",controller:"catalogCtrl"}).state("catalogEdit",{url:"/catalog/:productId/edit",templateUrl:"catalog.edit.html",controller:"catalogEditCtrl"}).state("profile",{url:"/{username:[a-zA-Z1-9.-]*}",templateUrl:"user.profile.html",controller:"userCtrl"}).state("editProfile",{url:"/:username/edit",templateUrl:"user.edit.html",controller:"userEditCtrl"}),o.html5Mode(!0),a.otherwise("/catalog"),l.defaults.useXDomain=!0,e.loginUrl=r.api+"auth/login",e.signupUrl=r.api+"auth/register",e.facebook({clientId:"1496399374007633",url:r.api+"auth/facebook"}),e.google({clientId:"13356134084-uo1b2bi0sn6vhvdslphhem7desofd5rt.apps.googleusercontent.com",url:r.api+"auth/google"})}];
var kgCtrl=["$scope","$rootScope","$http","$state","$auth","$sce","$location","$interval","kgConfig",function(t,a,e,o,c,n,i,s,u){a.api=u.api,a.files=u.files,t.modalTemplate="",t.modal=UIkit.modal("#kg-modal"),t.modal2=UIkit.modal("#kg-modal-lightbox"),t.feedback={},t.popup=function(){$(".browse").popup({inline:!0,hoverable:!0,delay:{show:300,hide:800}})},e.get(u.api+"category").success(function(a){t.categories=a.categories,t.popup()}),t.refreshToken=function(){e.get(u.api+"auth/refresh").then(function(t){var a=t.headers("Authorization");c.setToken(a)})["catch"](function(t){return!1})},t.getAuthUser=function(){e.get(u.api+"auth/user").success(function(e){a.auth=e.user,t.popup()})},t.authenticate=function(a){c.authenticate(a).then(function(a){t.getAuthUser(),t.modal2.hide()})["catch"](function(t){t.error?UIkit.notify(t.error):t.data?UIkit.notify(t.data.message,t.status):UIkit.notify(t)})},t.loginPage=function(){t.modalTemplate="user.login.html",t.modal2.show()},t.loginMember=function(a){c.login(a).then(function(a){t.modal2.hide(),t.getAuthUser()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.registerPage=function(){t.modalTemplate="user.register.html",t.modal.show()},t.registerMember=function(a){c.signup(a).then(function(a){c.setToken(a),t.getAuthUser(),t.modal2.hide()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.isLogin=function(){return c.isAuthenticated()},t.logout=function(){c.logout(),t.loginPage()},t.catalogDetail=function(a){t.loader=!0,e.get(u.api+"catalog/"+a).success(function(a){catalog=a.product,catalog.desc=n.trustAsHtml(catalog.desc),catalog.data=n.trustAsHtml(catalog.data),t.modalTemplate="catalog.detail.html",t.modal.show(),t.knob={},t.knob.options={readOnly:!0,max:5,trackWidth:40,barWidth:30,trackColor:"#eee",barColor:"#0079ab"},t.productId=catalog.id,t.catalog=catalog,t.loader=!1})},t.embedPreview=function(t){var a='<a href="'+t+'" class="embedly-card preview-card">Embedly</a>';$(".embed-preview").html(a),embedly("card",".preview-card")},t.createCatalog=function(){t.modalTemplate="catalog.create.html",t.modal.show()},t.saveCatalog=function(a){e.post(u.api+"catalog",a).success(function(a){UIkit.notify(a.message,a.status),t.modal.hide(),o.go("catalogEdit",{productId:a.product_id})})},t.addCollect=function(){e.post(u.api+"catalog/"+t.productId+"/collect").success(function(a){UIkit.notify(a.message,a.status),"success"==a.status&&t.productDetail.num_collect++})},t.giveRate=function(a){var o={criteria_id:a.id,rate_value:a.avg_criteria[0].criteria_rate};e.post(u.api+"catalog/"+t.productId+"/rate",o).success(function(t){UIkit.notify(t.message,t.status)})},t.sendFb=function(a){e.post(u.api+"catalog/"+t.productId+"/feedback",a).success(function(a){UIkit.notify(a.message,a.status),"success"==a.status&&("P"==t.feedback.feedback_type?(t.catalog.feedback_plus.push(a.data),t.catalog.numPlus+=1):"N"==t.feedback.feedback_type&&(t.catalog.feedback_minus.push(a.data),t.catalog.numMinus+=1),t.feedback.feedback_type=""),t.feedback.feedback_comment=""})},t.respondFb=function(t,a,o){e.post(u.api+"feedback/"+a+"/respond/"+o).success(function(a){UIkit.notify(a.message,a.status),"success"==a.status&&productDetail.feedback_minus[t].plus_respond++})},t.setBlur=function(a){t.blur=a},t.navbarSubToggle=function(a){0==t.navbarSubShow?t.navbarSubShow=!0:t.navbarSubShow=!1,t.navbarSub=a},t.closeModal=function(){t.modal.hide()},$("#kg-modal").on({"show.uk.modal":function(){t.blur=!0},"hide.uk.modal":function(){t.$apply(function(){t.blur=!1}),t.modalTemplate=""}}),t.isLogin()?t.getAuthUser():t.refreshToken()||t.loginPage()}];
var userEditCtrl=["$stateParams","$scope","$rootScope","$http","kgConfig",function(e,t,a,s,r){s({method:"GET",url:r.api+e.username+"/edit"}).success(function(e){t.user=e.user,t.user.profile=e.user.user_profile,t.user.profile.born=new Date(1e3*+t.user.profile.born),$(".ui.accordion").accordion("refresh")}),t.updateProfile=function(e){e.born=Date.parse(e.born)/1e3,s.put(r.api+a.user.name+"/profile",e).success(function(e){UIkit.notify(e.message,e.status)})},t.changeUser=function(e,t){"name"==e?data={name:t}:"email"==e?data={email:t}:"password"==e&&(data=t),s.put(r.api+a.user.name+"/"+e,data).success(function(e){UIkit.notify(e.data.success,e.status)})["catch"](function(e){UIkit.notify(e.data.error,e.status)})}}];
var userCtrl=["$state","$stateParams","$scope","$rootScope","$http","kgConfig",function(e,t,s,c,n,o){s.cropMeModal=UIkit.modal("#cropMeModal"),n.get(o.api+t.username).success(function(e){for(s.user=e.user,s.user.catalog_count=Object.keys(e.user.user_product).length,s.user.collect_count=Object.keys(e.user.user_collect).length,s.user.contact_count=Object.keys(e.user.user_contact).length,s.user.connect_count=Object.keys(e.user.user_connect).length,i=0;i<s.user.user_collect.length;i++)s.user.user_collect[i].product.name=s.user.user_collect[i].product.name.substr(0,20)})["catch"](function(e){}),s.savePict=function(e){n.put(o.api+c.user.name+"/pict",{user_pict:e}).success(function(t){UIkit.notify(t.message,t.status),s.cropMeModal.hide(),s.profile.user.user_pict=e})},s.addConnect=function(e){n.post(o.api+"connect/"+e).success(function(e){UIkit.notify(e.data.message,e.status)})},s.removeConnect=function(e){n["delete"](o.api+"connect/"+e).success(function(e){UIkit.notify(e.data.message,e.status)})},s.$on("cropme:done",function(e,t,c){var u=t.croppedImage;n({method:"POST",url:o.files+"saveavatar.php",data:u,headers:{"Content-Type":u.type}}).success(function(e){"success"==e.status&&s.savePict(e.filename,u)})})}];
var kgApp=angular.module("kgApp",["ui.router","ngTagsInput","satellizer","cropme","angular-input-stars","ui.knob","ngTouch","superswipe","validation.match","infinite-scroll"]),host=window.location.hostname;kgApp.constant("kgConfig",{site:"//"+host+"/",api:"//api."+host+"/",files:"//files."+host+"/",embedly:"8081dea79e164014bcd7cd7e1ab2363a"}).config(config).controller("kgCtrl",kgCtrl).controller("catalogCtrl",catalogCtrl).controller("catalogEditCtrl",catalogEditCtrl).controller("userCtrl",userCtrl).controller("userEditCtrl",userEditCtrl).directive("ngEnter",function(){return function(t,n,e){n.bind("keydown keypress",function(n){13===n.which&&(t.$apply(function(){t.$eval(e.ngEnter)}),n.preventDefault())})}}).directive("stopEvent",function(){return{restrict:"A",link:function(t,n,e){n.on(e.stopEvent,function(t){t.stopPropagation()})}}}).directive("kgUiDropdown",function(){return function(t,n,e){n.dropdown()}}).directive("kgUiAccordion",function(){return function(t,n,e){$(n).accordion()}}).directive("kgPopup",function(){return function(t,n){n.popup({variation:"inverted",position:"bottom center"})}}).directive("kgTab",function(){return function(t,n){n.tab()}}),function(t,n){var e="embedly-platform",o="script";if(!n.getElementById(e)){t.embedly=t.embedly||function(){(t.embedly.q=t.embedly.q||[]).push(arguments)};var r=n.createElement(o);r.id=e,r.async=1,r.src=("https:"===document.location.protocol?"https":"http")+"://cdn.embedly.com/widgets/platform.js";var i=n.getElementsByTagName(o)[0];i.parentNode.insertBefore(r,i)}}(window,document);

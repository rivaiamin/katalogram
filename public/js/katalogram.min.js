var catalogCategoryCtrl=["$scope","$rootScope","$stateParams","$http","$state","$sce","$location","kgConfig",function(t,a,e,o,c,r,s,g){var i=e.slug;t.filter.category=i,t.catalogList(),o.get(g.api+"category").success(function(a){t.categories=a.categories;var o=t.indexSearch(t.categories,parseInt(e.id));t.category=t.categories[o]})}];
catalogDetailCtrl=["$scope","$stateParams","$rootScope","$http","$state","$auth","$sce","$location","kgConfig",function(t,a,o,$,c,e,s,i,l){}];
var catalogEditCtrl=["$stateParams","$scope","$rootScope","$http","$state","$sce","kgConfig","Upload",function(t,e,a,o,r,c,u,s){e.modal1=UIkit.modal("#cropmeModal"),e.modal2=UIkit.modal("#cropmeModal2"),e.product={},e.isSaving=!1,a.bgNav="kg-bg-base",o({method:"GET",url:u.api+"catalog/"+t.productId+"/edit"}).success(function(t){null==t.product&&r.go("profile",{username:a.auth.name}),e.product=t.product,e.productId=e.product.id;var o=t.product.product_criteria,c=t.product.product_tag;for(e.product.tag=[],e.product.criteria=[],i=0;i<o.length;i++)e.product.criteria.push(o[i].criteria);for(i=0;i<c.length;i++)e.product.tag.push(c[i].tag);$(".ui.checkbox").checkbox(),$(".ui.accordion").accordion("refresh"),$(".special.cards .image").dimmer({on:"hover"})}),e.selectCats=function(){e.catInd=$("#categoryId").prop("selectedIndex")-1},e.uploadLogo=function(t,a){t&&(e.onProgress1=!0,s.upload({url:u.api+"catalog/"+e.productId+"/logo",method:"POST",data:{image:a}}).then(function(t){e.onProgress1=!1,e.product.logo=t.data.logo},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress1=a}))},e.uploadPicture=function(t,a){t&&(e.onProgress2=!0,s.upload({url:u.api+"catalog/"+e.productId+"/picture",method:"POST",data:{image:a}}).then(function(t){e.onProgress2=!1,e.product.picture=t.data.picture},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress2=a}))},e.loadTags=function(t){return o.get(u.api+"tags",{cache:!0}).then(function(e){var a=e.data;return a.filter(function(e){return e.name.toLowerCase().indexOf(t.toLowerCase())!=-1})})},e.loadCriterias=function(t){return o.get(u.api+"criterias",{cache:!0}).then(function(e){var a=e.data;return a.filter(function(e){return e.name.toLowerCase().indexOf(t.toLowerCase())!=-1})})},e.addCriteria=function(t){o.post(u.api+"catalog/"+e.productId+"/criteria",t).success(function(t){return"success"==t.status})},e.removeCriteria=function(t){return!!confirm("hapus kriteria?")&&void o["delete"](u.api+"catalog/"+e.productId+"/criteria/"+t.name).success(function(t){return"success"==t.status})},e.addTag=function(t){o.post(u.api+"catalog/"+e.productId+"/tag",t).success(function(t){return"success"==t.status})},e.removeTag=function(t){return!!confirm("hapus tag?")&&void o["delete"](u.api+"catalog/"+e.productId+"/tag/"+t.name).success(function(t){return"success"==t.status})},e.toggleRelease=function(){0==e.product.is_release?e.product.is_release=1:1==e.product.is_release&&(e.product.is_release=0),console.log(e.product.is_release)},e.updateProduct=function(t){e.isSaving=!0;var a=$("#is_release").prop("checked")?1:0,r={name:t.name,category_id:t.category_id,quote:t.quote,data:t.data,desc:t.desc,embed:t.embed,is_release:a};o.put(u.api+"catalog/"+e.productId,r).success(function(t){e.isSaving=!1})},e.removeProduct=function(){confirm("hapus produk?")&&o["delete"](u.api+"catalog/"+e.productId).success(function(t){UIkit.notify(t.message,t.status),r.go("profile",{username:a.auth.name})})}}];
var catalogCtrl=["$scope","$rootScope","$stateParams","$http","$state","$sce","$location","kgConfig",function(a,t,l,s,o,c,r,g){a.catalogs=[],a.scrollBusy=!1,a.scrollLast=!1,a.limit=8,a.after=0,a.onSearch=!1,a.filter={},a.url=r.absUrl(),t.bgNav="",t.modalTemplate1="",t.$on("searchCatalog",function(){a.after=0,a.catalogs=[],a.filter.tags=t.filter.tags,a.catalogList()}),a.catalogList=function(){a.scrollBusy=!0,s.get(g.api+"catalog/"+a.after+"/"+a.limit,{params:{category:a.filter.category,tags:JSON.stringify(a.filter.tags)}}).success(function(t){for(var l=0;l<t.catalogs.length;l++)a.catalogs.push(t.catalogs[l]);t.catalogs.length>0?a.after=t.catalogs[t.catalogs.length-1].id:a.scrollLast=!0,a.scrollBusy=!1})}}];
var config=["$stateProvider","$sceProvider","$rootScopeProvider","$httpProvider","$urlRouterProvider","$authProvider","$locationProvider","kgConfig",function(t,e,l,o,a,r,i,c){var u=["$q","$location","$auth",function(t,e,l){var o=t.defer();return l.isAuthenticated()?e.path("/catalog"):o.resolve(),o.promise}];t.state("home",{url:"/",templateUrl:"homepage.html",controller:"homeCtrl",resolve:{skipIfLoggedIn:u}}).state("catalog",{url:"/catalog",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalog.category",{url:"/category/:slug/:id",templateUrl:"catalog.list.category.html",controller:"catalogCategoryCtrl"}).state("catalog.view",{url:"/:productId/view",onEnter:["$stateParams","$rootScope",function(t,e){e.catalogDetail(t.productId)}],onExit:["$stateParams","$rootScope",function(t,e){""!=e.modalTemplate1&&e.modal1.hide()}]}).state("catalog.detail",{url:"/:productId",templateUrl:"catalog.detail.html"}).state("catalogEdit",{url:"/catalog/:productId/edit",templateUrl:"catalog.edit.html",controller:"catalogEditCtrl"}).state("profile",{url:"/{username:[a-zA-Z1-9.-]*}",templateUrl:"user.profile.html",controller:"userCtrl"}).state("editProfile",{url:"/:username/edit",templateUrl:"user.edit.html",controller:"userEditCtrl"}),a.otherwise("/"),i.html5Mode(!0),o.defaults.useXDomain=!0,r.loginUrl=c.api+"auth/login",r.signupUrl=c.api+"auth/register",r.facebook({clientId:c.fb,url:c.api+"auth/facebook"}),r.google({clientId:c.google,url:c.api+"auth/google"})}];
homeCtrl=["$scope","$stateParams","$rootScope","$http","$state","$auth","$sce","$location","kgConfig",function(a,t,o,s,c,l,e,g,r){a.catalogs=[],a.limit=5,a.after=0,a.url=g.absUrl(),o.modalTemplate1="",s.get(r.api+"catalog/0/5").success(function(t){for(var o=0;o<t.catalogs.length;o++)a.catalogs.push(t.catalogs[o])})}];
var kgCtrl=["$scope","$rootScope","$http","$state","$auth","$sce","$location","$interval","kgConfig",function(t,e,a,o,c,n,i,s,l){e.api=l.api,e.files=l.files,e.modalTemplate1="",t.modalTemplate2="",e.modal1=UIkit.modal("#kg-modal"),t.modal2=UIkit.modal("#kg-modal-lightbox"),t.feedback={},t.isSendFeedback=!1,t.isCollecting=!1,t.indexSearch=function(t,e){return t.map(function(t){return t.id}).indexOf(e)},t.popup=function(){$(".browse").popup({inline:!0,hoverable:!0,delay:{show:300,hide:800}})},a.get(l.api+"category").success(function(e){t.categories=e.categories,t.popup()}),t.loadTags=function(t){return a.get(l.api+"tags",{cache:!0}).then(function(e){var a=e.data;return a.filter(function(e){return e.name.toLowerCase().indexOf(t.toLowerCase())!=-1})})},t.refreshToken=function(){a.get(l.api+"auth/refresh").then(function(t){var e=t.headers("Authorization");c.setToken(e)})["catch"](function(t){return!1})},t.getAuthUser=function(){a.get(l.api+"auth/user").success(function(a){e.auth=a.user,t.popup()})},t.authenticate=function(e){c.authenticate(e).then(function(e){t.getAuthUser(),t.modal2.hide()})["catch"](function(t){t.error?UIkit.notify(t.error):t.data?UIkit.notify(t.data.message,t.status):UIkit.notify(t)})},t.loginPage=function(){t.modalTemplate2="user.login.html",t.modal2.show()},t.loginMember=function(e){c.login(e).then(function(e){t.modal2.hide(),t.getAuthUser()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.registerPage=function(){t.modalTemplate2="user.register.html"},t.registerMember=function(e){c.signup(e).then(function(e){c.setToken(e),t.getAuthUser(),t.modal2.hide()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.isLogin=function(){return c.isAuthenticated()},t.logout=function(){c.logout(),t.loginPage()},t.createCatalog=function(){e.modalTemplate1="catalog.create.html",t.modal1.show()},t.saveCatalog=function(e){a.post(l.api+"catalog",e).success(function(e){UIkit.notify(e.message,e.status),t.modal1.hide(),o.go("catalogEdit",{productId:e.product_id})})},e.catalogDetail=function(o){t.loader=!0,a.get(l.api+"catalog/"+o).success(function(a){catalog=a.product,catalog.desc=n.trustAsHtml(catalog.desc),catalog.data=n.trustAsHtml(catalog.data),e.modalTemplate1="catalog.detail.html",e.modal1.show(),t.knob={},t.knob.options={readOnly:!0,max:5,trackWidth:40,barWidth:30,trackColor:"#eee",barColor:"#FF8E1F"},t.productId=catalog.id,t.catalog=catalog,t.loader=!1})},t.searchCatalog=function(t){e.filter=[],e.filter.tags=[];for(var a=0;a<t.length;a++)e.filter.tags.push(t[a].id);e.$emit("searchCatalog",{})},t.embedPreview=function(t){var e='<a href="'+t+'" class="embedly-card preview-card">Embedly</a>';$(".embed-preview").html(e),embedly("card",".preview-card")},t.addCollect=function(){0==t.isCollecting&&(t.isCollecting=!0,a.post(l.api+"collect/"+t.productId).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&t.catalog.collect_count++,t.catalog.is_collect=!0,t.isCollecting=!1}))},t.removeCollect=function(){0==t.isCollecting&&(t.isCollecting=!0,a["delete"](l.api+"collect/"+t.productId).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&t.catalog.collect_count--,t.catalog.is_collect=!1,t.isCollecting=!1}))},t.giveRate=function(e){var o={product_criteria_id:e.id,value:e.rate_avg};a.post(l.api+"catalog/"+t.productId+"/rate",o).success(function(t){UIkit.notify(t.message,t.status)})},t.sendFb=function(e){t.isSendFeedback=!0,a.post(l.api+"catalog/"+t.productId+"/feedback",e).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&("P"==t.feedback.type?(t.catalog.feedback_plus.push(e.data),t.catalog.plus_count+=1):"M"==t.feedback.type&&(t.catalog.feedback_minus.push(e.data),t.catalog.minus_count+=1),t.feedback.type=""),t.feedback.comment="",t.isSendFeedback=!1})},t.rmFb=function(e,o){if(confirm("hapus tanggapan ini?")){"P"==o?item=t.catalog.feedback_plus:"M"==o&&(item=t.catalog.feedback_minus);var c=t.indexSearch(item,e);a["delete"](l.api+"catalog/"+t.productId+"/feedback/"+e).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&("P"==o?(t.catalog.feedback_plus.splice(c,1),t.catalog.plus_count-=1):"M"==o&&(t.catalog.feedback_minus.splice(c,1),t.catalog.minus_count-=1))})}},t.respondFb=function(t,e,o){a.post(l.api+"feedback/"+e+"/respond/"+o).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&productDetail.feedback_minus[t].plus_respond++})},t.setBlur=function(e){t.blur=e},t.navbarSubToggle=function(e){0==t.navbarSubShow?t.navbarSubShow=!0:t.navbarSubShow=!1,t.navbarSub=e},t.closeModal=function(){t.modal.hide()},$("#kg-modal").on({"hide.uk.modal":function(){e.modalTemplate1="",o.go("^")}}),$("#kg-modal-lightbox").on({"show.uk.modal":function(){t.blur=!0},"hide.uk.modal":function(){t.$apply(function(){t.blur=!1}),t.modalTemplate2=""}}),t.isLogin()&&t.getAuthUser()}];
var userEditCtrl=["$stateParams","$scope","$rootScope","$state","$http","kgConfig","Upload",function(t,e,a,i,n,s,o){e.isSaving=!1,e.isAddLink=!1,e.progress1=!1,e.progress2=!1,void 0==e.auth&&i.go("profile"),e.auth.name!=t.username&&i.go("profile"),n({method:"GET",url:s.api+t.username+"/edit"}).success(function(t){e.edit=t.user,e.links=t.links,e.edit.profile=t.user.user_profile,e.edit.cover=e.edit.profile.cover,e.edit.profile.born=new Date(1e3*+e.edit.profile.born),$(".ui.accordion").accordion("refresh")}),e.saveProfile=function(t){e.isSaving=!0,n.put(s.api+a.auth.name+"/profile",t).success(function(t){UIkit.notify(t.message,t.status),e.isSaving=!1})},e.uploadPicture=function(t,i){t?(e.onProgress1=!0,o.upload({url:s.api+a.auth.name+"/picture",method:"POST",data:{image:i}}).then(function(t){e.onProgress1=!1,e.edit.picture=t.data.picture},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress1=a})):UIkit.notify("Ukuran atau format file tidak sesuai","error")},e.uploadCover=function(t,i){t?(e.onProgress2=!0,o.upload({url:s.api+a.auth.name+"/cover",method:"POST",data:{image:i}}).then(function(t){e.onProgress2=!1,e.edit.cover=t.data.cover},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress2=a})):UIkit.notify("Ukuran atau format file tidak sesuai","error")},e.addLink=function(t){e.isAddLink=!0,n.post(s.api+a.auth.name+"/link",t).success(function(t){UIkit.notify(t.message,t.status),e.edit.user_link.push(t.link),e.isAddLink=!1})},e.removeLink=function(t){if(confirm("Hapus link ini?")){var i=e.indexSearch(e.edit.user_link,t);n["delete"](s.api+a.auth.name+"/link/"+t).success(function(t){UIkit.notify(t.message,t.status),e.edit.user_link.splice(i,1)})}},e.changeUser=function(t,e){"name"==t?data={name:e}:"email"==t?data={email:e}:"password"==t&&(data=e),n.put(s.api+a.auth.name+"/"+t,data).success(function(t){UIkit.notify(t.data.success,t.status)})["catch"](function(t){UIkit.notify(t.data.error,t.status)})}}];
var userCtrl=["$state","$stateParams","$scope","$rootScope","$http","kgConfig",function(t,e,s,c,u,o){s.cropMeModal=UIkit.modal("#cropMeModal"),c.bgNav="",u.get(o.api+e.username).success(function(t){for(s.user=t.user,s.user.catalog_count=Object.keys(t.user.user_product).length,s.user.collect_count=Object.keys(t.user.user_collect).length,s.user.contact_count=Object.keys(t.user.user_contact).length,s.user.connect_count=Object.keys(t.user.user_connect).length,i=0;i<s.user.user_collect.length;i++)s.user.user_collect[i].product.name=s.user.user_collect[i].product.name.substr(0,20)})["catch"](function(t){}),s.addContact=function(t){u.post(o.api+"contact/"+t).success(function(t){UIkit.notify(t.message,t.status),"success"==t.status&&(s.user.is_contact=1)})},s.removeContact=function(t){u["delete"](o.api+"contact/"+t).success(function(t){UIkit.notify(t.message,t.status),"success"==t.status&&(s.user.is_contact=0)})}}];
!function(t,o){var e="embedly-platform",n="script";if(!o.getElementById(e)){t.embedly=t.embedly||function(){(t.embedly.q=t.embedly.q||[]).push(arguments)};var r=o.createElement(n);r.id=e,r.async=1,r.src=("https:"===document.location.protocol?"https":"http")+"://cdn.embedly.com/widgets/platform.js";var i=o.getElementsByTagName(n)[0];i.parentNode.insertBefore(r,i)}}(window,document),window.onload=function(){window.loading_screen.finish()};var host=window.location.hostname;"katalogram.dev"==host?(fbid="1506049499709287",googleid="13356134084-uo1b2bi0sn6vhvdslphhem7desofd5rt.apps.googleusercontent.com"):"katalogram.com"==host&&(fbid="1496399374007633",googleid="13356134084-uo1b2bi0sn6vhvdslphhem7desofd5rt.apps.googleusercontent.com");var kgApp=angular.module("kgApp",["ui.router","ngTagsInput","satellizer","ngFileUpload","angular-input-stars","ui.knob","ngTouch","superswipe","validation.match","infinite-scroll"]);kgApp.constant("kgConfig",{site:"//"+host+"/",api:"//api."+host+"/",files:"//files."+host+"/",embedly:"8081dea79e164014bcd7cd7e1ab2363a",fb:fbid,google:googleid}).config(config).controller("kgCtrl",kgCtrl).controller("homeCtrl",homeCtrl).controller("catalogCtrl",catalogCtrl).controller("catalogCategoryCtrl",catalogCategoryCtrl).controller("catalogEditCtrl",catalogEditCtrl).controller("userCtrl",userCtrl).controller("userEditCtrl",userEditCtrl).directive("ngEnter",function(){return function(t,o,e){o.bind("keydown keypress",function(o){13===o.which&&(t.$apply(function(){t.$eval(e.ngEnter)}),o.preventDefault())})}}).directive("stopEvent",function(){return{restrict:"A",link:function(t,o,e){o.on(e.stopEvent,function(t){t.stopPropagation()})}}}).directive("kgUiDropdown",function(){return function(t,o,e){o.dropdown()}}).directive("kgUiAccordion",function(){return function(t,o,e){$(o).accordion()}}).directive("kgUiCheckbox",function(){return function(t,o,e){$(o).checkbox("toggle")}}).directive("kgUiDimmer",function(){return function(t,o,e){$(o).dimmer({on:"hover"})}}).directive("kgPopup",function(){return function(t,o){o.popup({variation:"inverted",position:"bottom center"})}}).directive("kgTab",function(){return function(t,o){o.tab()}});


var catalogEditCtrl=["$stateParams","$scope","$rootScope","$http","$sce","kgConfig",function(t,e,c,o,a,d){e.modal1=UIkit.modal("#cropmeModal"),e.modal2=UIkit.modal("#cropmeModal2"),e.addPreview=!1,e.preview={},o({method:"GET",url:d.api+"catalog/"+t.productId+"/edit"}).success(function(t){e.edit=t,e.edit.product=t.product[0],e.productId=e.edit.product.id,e.catInd=e.categories.map(function(t){return t.id}).indexOf(e.edit.product.category_id),e.categories=c.categories,$(".ui.checkbox").checkbox(),$(".ui.accordion").accordion("refresh"),$(".special.cards .image").dimmer({on:"hover"})}),e.selectCats=function(){e.catInd=$("#categoryId").prop("selectedIndex")-1},e.saveLogo=function(t,c){o.put(d.api+"catalog/"+e.productId+"/logo",{product_logo:t}).success(function(c){UIkit.notify(c.message,c.status),e.edit.product.product_logo=t})},e.savePreview=function(t){o.post(d.api+"catalog/"+e.productId+"/preview",t).success(function(t){UIkit.notify(t.message,t.status),e.addPreview=!1})},e.addCriteria=function(t){o.post(d.api+"catalog/"+e.productId+"/criteria",t).success(function(t){return"success"==t.status?!0:!1})},e.removeCriteria=function(t){return confirm("hapus kriteria?")?void o["delete"](d.api+"catalog/"+e.productId+"/criteria/"+t.id).success(function(t){return"success"==t.status?!0:void 0}):!1},e.addTag=function(t){o.post(d.api+"catalog/"+e.productId+"/tag",t).success(function(t){return"success"==t.status?!0:!1})},e.removeTag=function(t){return confirm("hapus tag?")?void o["delete"](d.api+"catalog/"+e.productId+"/tag/"+t.id).success(function(t){return"success"==t.status?!0:void 0}):!1},e.updateCatalog=function(t,c){var a={product_name:t.product_name,category_id:t.category_id,product_quote:t.product_quote,product_data:t.product_data,product_desc:t.product_desc,product_embed:t.product_embed};if(1==c){if(!confirm("simpan dan publikasikan?"))return!1;a.product_release=1}o.put(d.api+"catalog/"+e.productId,a).success(function(t){UIkit.notify(t.message,t.status)})},e.$on("cropme:done",function(t,c,a){var i=c.croppedImage;"cropme1"==a[0].id?o({method:"POST",url:d.files+"saveimage.php",data:i,headers:{"Content-Type":i.type}}).success(function(t){"success"==t.status&&(e.saveLogo(t.filename,i),e.modal1.hide())}):"cropme2"==a[0].id&&o({method:"POST",url:d.files+"savepreview.php",data:i,headers:{"Content-Type":i.type}}).success(function(t){"success"==t.status&&(e.addPreview=!0,e.preview.preview_pict=t.filename,e.modal2.hide())})})}];
var catalogCtrl=["$scope","$http","$location","$stateParams","kgConfig",function(a,t,l,s,o){a.catalogs=[],a.scrollBusy=!1,a.limit=12,a.after=0,a.onSearch=!1,a.filter={},a.url=l.absUrl(),a.catalogList=function(){a.scrollBusy=!0,t.get(o.api+"catalog/"+a.after+"/"+a.limit,{params:a.filter}).success(function(t){for(var l=0;l<t.catalogs.length;l++)a.catalogs.push(t.catalogs[l]);t.catalogs.length>0&&(a.after=t.catalogs[t.catalogs.length-1].id,a.scrollBusy=!1)})}}];
var config=["$stateProvider","$httpProvider","$urlRouterProvider","$authProvider","$locationProvider","kgConfig",function(t,l,a,e,o,r){t.state("home",{url:"/",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalog",{url:"/catalog",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalogCategory",{url:"/catalog/category/:categoryId",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalogDetail",{url:"/catalog/:productId",templateUrl:"catalog.detail.html",controller:"catalogCtrl"}).state("catalogEdit",{url:"/catalog/:productId/edit",templateUrl:"catalog.edit.html",controller:"catalogEditCtrl"}).state("profile",{url:"/{username:[a-zA-Z1-9.-]*}",templateUrl:"user.profile.html",controller:"userCtrl"}).state("editProfile",{url:"/:username/edit",templateUrl:"user.edit.html",controller:"userEditCtrl"}),o.html5Mode(!0),a.otherwise("/catalog"),l.defaults.useXDomain=!0,e.loginUrl=r.api+"auth/login",e.signupUrl=r.api+"auth/register",e.facebook({clientId:"1496399374007633",url:r.api+"auth/facebook"}),e.google({clientId:"13356134084-uo1b2bi0sn6vhvdslphhem7desofd5rt.apps.googleusercontent.com",url:r.api+"auth/google"})}];
var kgCtrl=["$scope","$rootScope","$http","$state","$auth","$sce","$location","$interval","kgConfig",function(t,e,a,o,c,n,s,i,u){e.api=u.api,e.files=u.files,t.modalTemplate="",t.modal=UIkit.modal("#kg-modal"),t.feedback={},t.popup=function(){$(".browse").popup({inline:!0,hoverable:!0,delay:{show:300,hide:800}})},a.get(u.api+"category").success(function(e){t.categories=e.categories,t.popup()}),t.refreshToken=function(){a.get(u.api+"auth/refresh").then(function(t){var e=t.headers("Authorization");c.setToken(e)})["catch"](function(t){return!1})},t.getAuthUser=function(){a.get(u.api+"auth/user").success(function(a){e.user=a.user,t.popup()})},t.authenticate=function(e){c.authenticate(e).then(function(e){t.getAuthUser(),t.modal.hide()})["catch"](function(t){t.error?UIkit.notify(t.error):t.data?UIkit.notify(t.data.message,t.status):UIkit.notify(t)})},t.loginPage=function(){t.modalTemplate="user.login.html",t.modal.show()},t.loginMember=function(e){c.login(e).then(function(e){t.modal.hide(),t.getAuthUser()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.registerPage=function(){t.modalTemplate="user.register.html",t.modal.show()},t.registerMember=function(e){c.signup(e).then(function(e){c.setToken(e),t.getAuthUser(),t.modal.hide()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.isLogin=function(){return c.isAuthenticated()},t.logout=function(){c.logout(),t.loginPage()},t.catalogDetail=function(e){t.loader=!0,a.get(u.api+"catalog/"+e).success(function(e){catalog=e.product,catalog.desc=n.trustAsHtml(catalog.desc),catalog.data=n.trustAsHtml(catalog.data),t.modalTemplate="catalog.detail.html",t.modal.show(),t.knob={},t.knob.options={readOnly:!0,max:5,trackWidth:40,barWidth:30,trackColor:"#eee",barColor:"#0079ab"},t.productId=catalog.id,t.catalog=catalog,t.loader=!1})},t.embedPreview=function(t){var e='<a href="'+t+'" class="embedly-card preview-card">Embedly</a>';$(".embed-preview").html(e),embedly("card",".preview-card")},t.createCatalog=function(){t.modalTemplate="catalog.create.html",t.modal.show()},t.saveCatalog=function(e){a.post(u.api+"catalog",e).success(function(e){UIkit.notify(e.message,e.status),t.modal.hide(),o.go("catalogEdit",{productId:e.product_id})})},t.addCollect=function(){a.post(u.api+"catalog/"+t.productId+"/collect").success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&t.productDetail.num_collect++})},t.giveRate=function(e){var o={criteria_id:e.id,rate_value:e.avg_criteria[0].criteria_rate};a.post(u.api+"catalog/"+t.productId+"/rate",o).success(function(t){UIkit.notify(t.message,t.status)})},t.sendFb=function(e){a.post(u.api+"catalog/"+t.productId+"/feedback",e).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&("P"==t.feedback.feedback_type?(t.catalog.feedback_plus.push(e.data),t.catalog.numPlus+=1):"N"==t.feedback.feedback_type&&(t.catalog.feedback_minus.push(e.data),t.catalog.numMinus+=1),t.feedback.feedback_type=""),t.feedback.feedback_comment=""})},t.respondFb=function(t,e,o){a.post(u.api+"feedback/"+e+"/respond/"+o).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&productDetail.feedback_minus[t].plus_respond++})},t.setBlur=function(e){t.blur=e},t.navbarSubToggle=function(e){0==t.navbarSubShow?t.navbarSubShow=!0:t.navbarSubShow=!1,t.navbarSub=e},t.closeModal=function(){t.modal.hide()},$("#kg-modal").on({"show.uk.modal":function(){t.blur=!0},"hide.uk.modal":function(){t.$apply(function(){t.blur=!1}),t.modalTemplate=""}}),t.isLogin()?t.getAuthUser():t.refreshToken()||t.loginPage()}];
var userEditCtrl=["$stateParams","$scope","$rootScope","$http","kgConfig",function(e,t,a,r,s){r({method:"GET",url:s.api+e.username+"/edit"}).success(function(e){t.profile=e,t.profile.member=e.user.member,t.profile.member.born=new Date(1e3*+t.profile.member.member_born),$(".ui.accordion").accordion("refresh")}),t.updateProfile=function(e){e.member_born=Date.parse(e.born)/1e3,r.put(s.api+a.user.name+"/profile",e).success(function(e){UIkit.notify(e.message,e.status)})},t.changeUser=function(e,t){"name"==e?data={name:t}:"email"==e?data={email:t}:"password"==e&&(data=t),r.put(s.api+a.user.name+"/"+e,data).success(function(e){UIkit.notify(e.data.success,e.status)})["catch"](function(e){UIkit.notify(e.data.error,e.status)})}}];
var userCtrl=["$state","$stateParams","$scope","$rootScope","$http","kgConfig",function(e,t,c,s,n,o){c.cropMeModal=UIkit.modal("#cropMeModal"),n.get(o.api+t.username).success(function(e){c.user=e.user,c.user.catalog_count=Object.keys(e.user.product).length,c.user.collect_count=Object.keys(e.user.user_collect).length,c.user.contact_count=Object.keys(e.user.user_contact).length,c.user.connect_count=Object.keys(e.user.user_connect).length})["catch"](function(e){}),c.savePict=function(e){n.put(o.api+s.user.name+"/pict",{user_pict:e}).success(function(t){UIkit.notify(t.message,t.status),c.cropMeModal.hide(),c.profile.user.user_pict=e})},c.addConnect=function(e){n.post(o.api+"connect/"+e).success(function(e){UIkit.notify(e.data.message,e.status)})},c.removeConnect=function(e){n["delete"](o.api+"connect/"+e).success(function(e){UIkit.notify(e.data.message,e.status)})},c.$on("cropme:done",function(e,t,s){var u=t.croppedImage;n({method:"POST",url:o.files+"saveavatar.php",data:u,headers:{"Content-Type":u.type}}).success(function(e){"success"==e.status&&c.savePict(e.filename,u)})})}];
var kgApp=angular.module("kgApp",["ui.router","ngTagsInput","satellizer","cropme","angular-input-stars","ui.knob","ngTouch","superswipe","validation.match","infinite-scroll"]),host=window.location.hostname;kgApp.constant("kgConfig",{site:"//"+host+"/",api:"//api."+host+"/",files:"//files."+host+"/",embedly:"8081dea79e164014bcd7cd7e1ab2363a"}).config(config).controller("kgCtrl",kgCtrl).controller("catalogCtrl",catalogCtrl).controller("catalogEditCtrl",catalogEditCtrl).controller("userCtrl",userCtrl).controller("userEditCtrl",userEditCtrl).directive("ngEnter",function(){return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.ngEnter)}),e.preventDefault())})}}).directive("stopEvent",function(){return{restrict:"A",link:function(t,e,n){e.on(n.stopEvent,function(t){t.stopPropagation()})}}}).directive("kgUiDropdown",function(){return function(t,e,n){e.dropdown()}}).directive("kgPopup",function(){return function(t,e){e.popup({variation:"inverted",position:"bottom center"})}}).directive("kgTab",function(){return function(t,e){e.tab()}}),function(t,e){var n="embedly-platform",o="script";if(!e.getElementById(n)){t.embedly=t.embedly||function(){(t.embedly.q=t.embedly.q||[]).push(arguments)};var r=e.createElement(o);r.id=n,r.async=1,r.src=("https:"===document.location.protocol?"https":"http")+"://cdn.embedly.com/widgets/platform.js";var i=e.getElementsByTagName(o)[0];i.parentNode.insertBefore(r,i)}}(window,document);

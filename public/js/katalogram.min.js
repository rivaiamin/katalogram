
var catalogEditCtrl=["$stateParams","$scope","$rootScope","$http","$sce","kgConfig","Upload",function(t,e,a,o,r,c,s){e.modal1=UIkit.modal("#cropmeModal"),e.modal2=UIkit.modal("#cropmeModal2"),e.product={},e.isSaving=!1,a.bgNav="kg-bg-base",o({method:"GET",url:c.api+"catalog/"+t.productId+"/edit"}).success(function(t){e.product=t.product,e.productId=e.product.id;var a=t.product.product_criteria,o=t.product.product_tag;for(e.product.tag=[],e.product.criteria=[],i=0;i<a.length;i++)e.product.criteria.push(a[i].criteria);for(i=0;i<o.length;i++)e.product.tag.push(o[i].tag);$(".ui.checkbox").checkbox(),$(".ui.accordion").accordion("refresh"),$(".special.cards .image").dimmer({on:"hover"})}),e.selectCats=function(){e.catInd=$("#categoryId").prop("selectedIndex")-1},e.uploadLogo=function(t,a){t&&(e.onProgress1=!0,s.upload({url:c.api+"catalog/"+e.productId+"/logo",method:"POST",data:{image:a}}).then(function(t){e.onProgress1=!1,e.product.logo=t.data.logo},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress1=a}))},e.uploadPicture=function(t,a){t&&(e.onProgress2=!0,s.upload({url:c.api+"catalog/"+e.productId+"/picture",method:"POST",data:{image:a}}).then(function(t){e.onProgress2=!1,e.product.picture=t.data.picture},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress2=a}))},e.loadTags=function(t){return o.get(c.api+"tags",{cache:!0}).then(function(e){var a=e.data;return a.filter(function(e){return-1!=e.name.toLowerCase().indexOf(t.toLowerCase())})})},e.loadCriterias=function(t){return o.get(c.api+"criterias",{cache:!0}).then(function(e){var a=e.data;return a.filter(function(e){return-1!=e.name.toLowerCase().indexOf(t.toLowerCase())})})},e.addCriteria=function(t){o.post(c.api+"catalog/"+e.productId+"/criteria",t).success(function(t){return"success"==t.status?!0:!1})},e.removeCriteria=function(t){return confirm("hapus kriteria?")?void o["delete"](c.api+"catalog/"+e.productId+"/criteria/"+t.id).success(function(t){return"success"==t.status?!0:!1}):!1},e.addTag=function(t){o.post(c.api+"catalog/"+e.productId+"/tag",t).success(function(t){return"success"==t.status?!0:!1})},e.removeTag=function(t){return confirm("hapus tag?")?void o["delete"](c.api+"catalog/"+e.productId+"/tag/"+t.id).success(function(t){return"success"==t.status?!0:!1}):!1},e.toggleRelease=function(){0==e.product.is_release?e.product.is_release=1:1==e.product.is_release&&(e.product.is_release=0),console.log(e.product.is_release)},e.updateProduct=function(t){e.isSaving=!0;var a=$("#is_release").prop("checked")?1:0,r={name:t.name,category_id:t.category_id,quote:t.quote,data:t.data,desc:t.desc,embed:t.embed,is_release:a};o.put(c.api+"catalog/"+e.productId,r).success(function(t){UIkit.notify(t.message,t.status),e.isSaving=!1})}}];
var catalogCtrl=["$scope","$rootScope","$http","$location","$stateParams","kgConfig",function(a,t,l,o,c,s){a.catalogs=[],a.scrollBusy=!1,a.limit=12,a.after=0,a.onSearch=!1,a.filter={},a.url=o.absUrl(),t.bgNav="";var r=c.categoryId;null!=r&&(a.filter.category=r),a.catalogList=function(){a.scrollBusy=!0,l.get(s.api+"catalog/"+a.after+"/"+a.limit,{params:a.filter}).success(function(t){for(var l=0;l<t.catalogs.length;l++)a.catalogs.push(t.catalogs[l]);t.catalogs.length>0&&(a.after=t.catalogs[t.catalogs.length-1].id,a.scrollBusy=!1)})}}];
var config=["$stateProvider","$httpProvider","$urlRouterProvider","$authProvider","$locationProvider","kgConfig",function(t,l,a,e,o,r){t.state("home",{url:"/",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalog",{url:"/catalog",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalogCategory",{url:"/category/:categoryId",templateUrl:"catalog.list.html",controller:"catalogCtrl"}).state("catalogDetail",{url:"/catalog/:productId",templateUrl:"catalog.detail.html",controller:"catalogCtrl"}).state("catalogEdit",{url:"/catalog/:productId/edit",templateUrl:"catalog.edit.html",controller:"catalogEditCtrl"}).state("profile",{url:"/{username:[a-zA-Z1-9.-]*}",templateUrl:"user.profile.html",controller:"userCtrl"}).state("editProfile",{url:"/:username/edit",templateUrl:"user.edit.html",controller:"userEditCtrl"}),o.html5Mode(!0),a.otherwise("/catalog"),l.defaults.useXDomain=!0,e.loginUrl=r.api+"auth/login",e.signupUrl=r.api+"auth/register",e.facebook({clientId:"1496399374007633",url:r.api+"auth/facebook"}),e.google({clientId:"13356134084-uo1b2bi0sn6vhvdslphhem7desofd5rt.apps.googleusercontent.com",url:r.api+"auth/google"})}];
var kgCtrl=["$scope","$rootScope","$http","$state","$auth","$sce","$location","$interval","kgConfig",function(t,e,a,o,n,c,i,s,u){e.api=u.api,e.files=u.files,t.modalTemplate="",t.modal=UIkit.modal("#kg-modal"),t.modal2=UIkit.modal("#kg-modal-lightbox"),t.feedback={},t.isSendFeedback=!1,t.indexSearch=function(t,e){return t.map(function(t){return t.id}).indexOf(e)},t.popup=function(){$(".browse").popup({inline:!0,hoverable:!0,delay:{show:300,hide:800}})},a.get(u.api+"category").success(function(e){t.categories=e.categories,t.popup()}),t.refreshToken=function(){a.get(u.api+"auth/refresh").then(function(t){var e=t.headers("Authorization");n.setToken(e)})["catch"](function(t){return!1})},t.getAuthUser=function(){a.get(u.api+"auth/user").success(function(a){e.auth=a.user,t.popup()})},t.authenticate=function(e){n.authenticate(e).then(function(e){t.getAuthUser(),t.modal2.hide()})["catch"](function(t){t.error?UIkit.notify(t.error):t.data?UIkit.notify(t.data.message,t.status):UIkit.notify(t)})},t.loginPage=function(){t.modalTemplate="user.login.html",t.modal2.show()},t.loginMember=function(e){n.login(e).then(function(e){t.modal2.hide(),t.getAuthUser()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.registerPage=function(){t.modalTemplate="user.register.html",t.modal.show()},t.registerMember=function(e){n.signup(e).then(function(e){n.setToken(e),t.getAuthUser(),t.modal2.hide()})["catch"](function(t){UIkit.notify(t.data.message,t.status)})},t.isLogin=function(){return n.isAuthenticated()},t.logout=function(){n.logout(),t.loginPage()},t.catalogDetail=function(e){t.loader=!0,a.get(u.api+"catalog/"+e).success(function(e){t.isCollect=e.isCollect,catalog=e.product,catalog.desc=c.trustAsHtml(catalog.desc),catalog.data=c.trustAsHtml(catalog.data),t.modalTemplate="catalog.detail.html",t.modal.show(),t.knob={},t.knob.options={readOnly:!0,max:5,trackWidth:40,barWidth:30,trackColor:"#eee",barColor:"#0079ab"},t.productId=catalog.id,t.catalog=catalog,t.loader=!1})},t.embedPreview=function(t){var e='<a href="'+t+'" class="embedly-card preview-card">Embedly</a>';$(".embed-preview").html(e),embedly("card",".preview-card")},t.createCatalog=function(){t.modalTemplate="catalog.create.html",t.modal.show()},t.saveCatalog=function(e){a.post(u.api+"catalog",e).success(function(e){UIkit.notify(e.message,e.status),t.modal.hide(),o.go("catalogEdit",{productId:e.product_id})})},t.addCollect=function(){input={product_id:t.productId},a.post(u.api+"collect",input).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&t.catalog.collect_count++})},t.giveRate=function(e){var o={product_criteria_id:e.id,value:e.rate_avg};a.post(u.api+"catalog/"+t.productId+"/rate",o).success(function(t){UIkit.notify(t.message,t.status)})},t.sendFb=function(e){t.isSendFeedback=!0,a.post(u.api+"catalog/"+t.productId+"/feedback",e).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&("P"==t.feedback.type?(t.catalog.feedback_plus.push(e.data),t.catalog.plus_count+=1):"M"==t.feedback.type&&(t.catalog.feedback_minus.push(e.data),t.catalog.minus_count+=1),t.feedback.type=""),t.feedback.comment="",t.isSendFeedback=!1})},t.respondFb=function(t,e,o){a.post(u.api+"feedback/"+e+"/respond/"+o).success(function(e){UIkit.notify(e.message,e.status),"success"==e.status&&productDetail.feedback_minus[t].plus_respond++})},t.setBlur=function(e){t.blur=e},t.navbarSubToggle=function(e){0==t.navbarSubShow?t.navbarSubShow=!0:t.navbarSubShow=!1,t.navbarSub=e},t.closeModal=function(){t.modal.hide()},$("#kg-modal").on({"show.uk.modal":function(){t.blur=!0},"hide.uk.modal":function(){t.$apply(function(){t.blur=!1}),t.modalTemplate=""}}),t.isLogin()?t.getAuthUser():t.refreshToken()||t.loginPage()}];
var userEditCtrl=["$stateParams","$scope","$rootScope","$state","$http","kgConfig","Upload",function(t,e,a,i,n,o,s){void 0==e.auth&&i.go("profile"),e.auth.name!=t.username&&i.go("profile"),n({method:"GET",url:o.api+t.username+"/edit"}).success(function(t){e.edit=t.user,e.links=t.links,e.edit.profile=t.user.user_profile,e.edit.cover=e.edit.profile.cover,e.edit.profile.born=new Date(1e3*+e.edit.profile.born),$(".ui.accordion").accordion("refresh")}),e.saveProfile=function(t){n.put(o.api+a.auth.name+"/profile",t).success(function(t){UIkit.notify(t.message,t.status)})},e.uploadPicture=function(t,i){t&&(e.onProgress1=!0,s.upload({url:o.api+a.auth.name+"/picture",method:"POST",data:{image:i}}).then(function(t){e.onProgress1=!1,e.edit.picture=t.data.picture},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress1=a}))},e.uploadCover=function(t,i){t?(e.onProgress2=!0,s.upload({url:o.api+a.auth.name+"/cover",method:"POST",data:{image:i}}).then(function(t){e.onProgress2=!1,e.edit.cover=t.data.cover},function(t){UIkit.notify(t.data.message,t.data.status)},function(t){var a=parseInt(100*t.loaded/t.total);e.progress2=a})):UIkit.notify("Ukuran atau format file tidak sesuai","error")},e.addLink=function(t){n.post(o.api+a.auth.name+"/link",t).success(function(t){UIkit.notify(t.message,t.status),e.edit.user_link.push(t.link)})},e.removeLink=function(t){if(confirm("Hapus link ini?")){var i=e.indexSearch(e.edit.user_link,t);n["delete"](o.api+a.auth.name+"/link/"+t).success(function(t){UIkit.notify(t.message,t.status),e.edit.user_link.splice(i,1)})}},e.changeUser=function(t,e){"name"==t?data={name:e}:"email"==t?data={email:e}:"password"==t&&(data=e),n.put(o.api+a.auth.name+"/"+t,data).success(function(t){UIkit.notify(t.data.success,t.status)})["catch"](function(t){UIkit.notify(t.data.error,t.status)})}}];
var userCtrl=["$state","$stateParams","$scope","$rootScope","$http","kgConfig",function(e,t,c,s,n,o){c.cropMeModal=UIkit.modal("#cropMeModal"),s.bgNav="",n.get(o.api+t.username).success(function(e){for(c.user=e.user,c.user.catalog_count=Object.keys(e.user.user_product).length,c.user.collect_count=Object.keys(e.user.user_collect).length,c.user.contact_count=Object.keys(e.user.user_contact).length,c.user.connect_count=Object.keys(e.user.user_connect).length,i=0;i<c.user.user_collect.length;i++)c.user.user_collect[i].product.name=c.user.user_collect[i].product.name.substr(0,20)})["catch"](function(e){}),c.addConnect=function(e){n.post(o.api+"connect/"+e).success(function(e){UIkit.notify(e.data.message,e.status)})},c.removeConnect=function(e){n["delete"](o.api+"connect/"+e).success(function(e){UIkit.notify(e.data.message,e.status)})}}];
var kgApp=angular.module("kgApp",["ui.router","ngTagsInput","satellizer","ngFileUpload","angular-input-stars","ui.knob","ngTouch","superswipe","validation.match","infinite-scroll"]),host=window.location.hostname;kgApp.constant("kgConfig",{site:"//"+host+"/",api:"//api."+host+"/",files:"//files."+host+"/",embedly:"8081dea79e164014bcd7cd7e1ab2363a"}).config(config).controller("kgCtrl",kgCtrl).controller("catalogCtrl",catalogCtrl).controller("catalogEditCtrl",catalogEditCtrl).controller("userCtrl",userCtrl).controller("userEditCtrl",userEditCtrl).directive("ngEnter",function(){return function(t,n,e){n.bind("keydown keypress",function(n){13===n.which&&(t.$apply(function(){t.$eval(e.ngEnter)}),n.preventDefault())})}}).directive("stopEvent",function(){return{restrict:"A",link:function(t,n,e){n.on(e.stopEvent,function(t){t.stopPropagation()})}}}).directive("kgUiDropdown",function(){return function(t,n,e){n.dropdown()}}).directive("kgUiAccordion",function(){return function(t,n,e){$(n).accordion()}}).directive("kgUiCheckbox",function(){return function(t,n,e){$(n).checkbox("toggle")}}).directive("kgUiDimmer",function(){return function(t,n,e){$(n).dimmer({on:"hover"})}}).directive("kgPopup",function(){return function(t,n){n.popup({variation:"inverted",position:"bottom center"})}}).directive("kgTab",function(){return function(t,n){n.tab()}}),function(t,n){var e="embedly-platform",o="script";if(!n.getElementById(e)){t.embedly=t.embedly||function(){(t.embedly.q=t.embedly.q||[]).push(arguments)};var i=n.createElement(o);i.id=e,i.async=1,i.src=("https:"===document.location.protocol?"https":"http")+"://cdn.embedly.com/widgets/platform.js";var r=n.getElementsByTagName(o)[0];r.parentNode.insertBefore(i,r)}}(window,document);
